# Chrome拡張機能でTwilio管理画面のアカウントを切り替えるExtensionを作る

## 作る理由

Subaccounts画面開いて切り替えると、再度同じ画面辿らないといけないので
めんどくさいんじゃあ。

あとはExtensionを作って公開することで勉強をする。

会社で作ってるExtensionはjQueryでゴリゴリしてて、イケてない。
webpack使ってバンドルは多少マシになってはいるが、それでも旧世代の遺物という所感。

これを作ったのは誰だあ！（バッ）



・・・
あ、俺でした。

これを改善するために、実際に手を動かしつつ、
もう少しモダンな作りを試してみました。

## 技術的な構成

### Vue.jsを使う

Laravel標準のフロントエンドはVue.jsなので、
Vue.jsを採用した。
Reactは完全に触ったことないが、
使えるようになるまでが大変らしいので、
Vue.jsにしている。

Twilioは[React推し](https://www.twilio.com/docs/flex/flex-overview-ui-programmability)らしいが。

### モジュールバンドラーはwebpackを使う

こだわりはない。

この手のモジュールバンドラーはなんとなく使ったことがある程度で、
比較基準があまりない。
そのため、割と最新であれば何でもいいかの精神で、
webpackを選択した。

webpackを使う理由は、ExtensionをVue.jsで使えるようにする
下記テンプレートを見つけたからという理由が大きい。
https://github.com/Kocal/vue-web-extension

Vue CLIをインストールして、上記GithubのREADMEを読んで、
とりあえずコピペでコマンドを叩けば、
Vue.jsを使ったExtension開発が始められるのでとても感動した。
Chromeのポリシーで、ExtensionにおいてVue.jsを使えない、
という古い理解のまま来ていたのでなんだ使えるじゃんと
認識を改められたのはでかい。

## 仕様

### マスターアカウントのSIDを登録する画面

最初はこの画面を表示する。
入力したら、ChromeのStorageに保存しておく。

[Chrome Sync](https://developers.chrome.com/extensions/storage#property-sync)というGoogleアカウントに紐づく保存領域を利用するので、
一度入力しておけば、PCを乗り換えたりしても利用できるのがメリットです。

### サブアカウントのSIDを登録する画面

マスターアカウントのSID登録後、
表示される画面。

管理コンソールのサブアカウント一覧ページを開いた後、
自動でページ内のサブアカウントSIDを取得し、
マスターアカウントSID同様にChrome Syncに保存します。

### アカウント切り替え画面

サブアカウントSIDの登録後、
登録されているアカウント一覧と切り替えボタンが表示されます。

ボタンを押すと、管理コンソールURLに紐づくCookieのcurrent-accountの値を、
押されたアカウントSIDに切り替えます。

### サブアカウント更新画面

初回登録後、サブアカウントが増減したときに使う画面です。

Chrome SyncにあるサブアカウントのSIDをすべて削除し、
その後登録する画面と同様の処理をします。

### アカウント削除画面

Chrome Syncにあるサブアカウント、マスターアカウントに関する
SIDをすべて削除します。



仕様としてはこの5つの機能が主です。
Twilioの管理コンソールでアカウント切替時にやっていることは、
実はCookieの値書き換えしかやっていません。
そのため、AuthTokenや管理コンソールのパスワードなどは保持しません。
安心して利用してください。

