# Twilioを用いたコンタクトセンター管理者を9ヶ月やった人からこれからTwilioをはじめる人へのメッセージ

こんにちは、[@24guchia](https://twitter.com/24guchia)です。
[Twilio Advent Calendar 2019](https://qiita.com/advent-calendar/2019/twilio)の14日目です。

タイトル長いですね。

何書こうかと、色々考えましたが、
Twilio Flexやってみたはもうまとめたので、
普段通りの持ちネタを話そうと思います。

ちなみにFlexのまとめに関しては下記参照してください。
https://harinoma.info/re-learn-twilio-flex/

技術や新しいサービスより、
長期で実際にTwilioを使っていたことが
貴重でシェアできる情報だと思っています。
期間が中途半端ですが改めてまとめて、
これからTwilioを使い始める人へのメッセージとします。

期間が中途半端な理由は9月で会社をやめたからです。
https://harinoma.info/retire-from-leverages/

## 2019年の振り返り

2018年の振り返りはこちら。
https://harinoma.info/look-back-renewal/

### Twilio Clientのアップデート

WebRTC標準化に備えてのアップデートですね。
ざっくり概要ですが、SDPのフォーマットにPlan AとPlan Bがあり、
Plan A(現Unified Plan)が採択されました。
ChromeはPlan Bを利用していたため、
Plan Bを削除に伴うTwilio Clientのアップデートです。

この辺の詳細は22日のアドベントカレンダーで
[@kimihom](https://twitter.com/kimihom)さんがまとめてくれるでしょう。

#### できるだけ最新バージョンを使おう

これからTwilioを使う人は
Twilio Clientの最新バージョンを利用しましょう。

ただし、Clientはアップデートが頻繁に行われますが、
ちょいちょいバグやデグレが発生します。
全体疎通を自動テストしたり、
国内Twilioユーザが集まるSlackで様子見したりして、
**自動アップデートは適用しないほうがベター**です。

### モニタリング・ウィスパリング機能の追加

モニタリングは通話中の通話に無音で参加すること、
ウィスパリングは通話中の通話に特定の人にのみ耳打ちできる状態で参加することです。
ビジネスフォンではよくある機能らしいですが、
僕ははじめて聞きました。

着手前は1ヶ月とかあれば終わるんじゃないですかね~~（適当）~~と
思ってましたが、とても実装が大変でした。

大変な理由は
* そもそもモニタリング・ウィスパリングを使ったことないから概念がよくわからない
* デバッグが大変
* 国内で実装したことある人がいないから誰にも聞けない

まあいつも通り、Twilioの新機能使う人ならではの大変でした。
詳細は下記にまとめてあります。
https://harinoma.info/implement-monitoring-and-whispering-with-agent-conference/

需要は大きかったようで、リリースしてから実際に使って役立ってます！
って意見を伝え聞けたので良いモチベーションになりました。

#### 覚悟はいいか？

これから実装するっていう方には、
**覚悟しておいてください**
としか言えませんね。がんばってください。

### 録音ファイルをTwilioからS3に移行した

S3に移行することで、月間相当な金額の料金を下げました。

Twilioはクラウドストレージサービスではないので、料金高めです。
そのため、最初から録音ファイルをどのように
取り扱うのかは当初から設計しておくとよいです。
移行に際し、Twilioから録音ファイルをダウンロードして、S3にアップロード。
成功したらTwilioから削除するバッチを作成しました。

また、通話終了のWebhookで即時S3にアップロードを
することで、Twilioに録音ファイルを置く時間を短くすることで
料金の低減に貢献しました。

#### 最初からTwilio以外のストレージサービスを利用しよう

すごそうに書きましたが、実稼働前からS3といった料金安い
クラウドストレージなどを利用できるよう実装することで、
**そもそもの利用料を下げられた**と考えてます。

予めTwilio以外のストレージサービスを利用するよう
設計に組み込んでおきましょう。

## まとめ

Twilioを大規模で実稼働させているところはまだ少ないため、
これから導入を考えている人にこの記事から学びがあると幸いです
Flexが本格的に導入され始めると、
大規模なコンタクトセンターの実例も増えていくかなと考えてます。

現在は業務でTwilioに携わることはなくなりましたが、
これからもキャッチアップは続けていくつもりです。
引き続きよろしくお願いします。